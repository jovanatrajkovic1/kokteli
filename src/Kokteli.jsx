import React, { useEffect, useState } from 'react';
import KoktelKartica from './KoktelKartica';
import axios from 'axios';

function Kokteli({ kokteli }) {
    const [searchTerm, setSearchTerm] = useState('');
    const [sortByRating, setSortByRating] = useState(false); // Dr탑imo da li je sortiranje po oceni aktivno

    const filteredKokteli = kokteli.filter(koktel => 
        koktel.name.toLowerCase().includes(searchTerm.toLowerCase())
    );

    // Ra훾unamo prose훾nu ocenu za svaki koktel
    const averageRating = (reviews) => {
        const total = reviews.reduce((acc, review) => acc + review.rating, 0);
        return reviews.length ? total / reviews.length : 0;
    };

    const sortedKokteli = sortByRating 
        ? [...filteredKokteli].sort((a, b) => averageRating(b.reviews) - averageRating(a.reviews))
        : filteredKokteli;

    const [images, setImages] = useState([]);

    useEffect(() => {
        async function fetchRandomCocktailImages() {
            const numberOfImages = 5;
            const fetchedImages = [];

            for (let i = 0; i < numberOfImages; i++) {
                const response = await axios.get('https://www.thecocktaildb.com/api/json/v1/1/random.php');
                fetchedImages.push(response.data.drinks[0].strDrinkThumb);
            }

            setImages(fetchedImages);
        }

        fetchRandomCocktailImages();
    }, []);

    return (
        <div className="kokteli-container">
            <div className="controls-container">
                <input
                    type="text"
                    placeholder="Pretra탑i koktele..."
                    value={searchTerm}
                    onChange={e => setSearchTerm(e.target.value)}
                />
                {/* Dugme za sortiranje po oceni */}
                <button onClick={() => setSortByRating(prev => !prev)}>
                    Sortiraj po oceni
                </button>
            </div>

            {sortedKokteli.map((koktel, i) => (
                <KoktelKartica key={koktel.id} cocktail={koktel} image={images[i]} />
            ))}
        </div>
    );
}

export default Kokteli;
